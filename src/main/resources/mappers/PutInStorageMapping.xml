<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhzh.wms.dao.PutInStorageDao">
    <resultMap id="wmsInvInDto" type="com.jhzh.wms.dto.WmsInvInDto">
        <result column="id" property="id"/>
        <result column="unt" property="unt"/>
        <result column="app" property="app"/>
        <result column="taskid" property="taskId"/>
        <result column="tasksource" property="taskSource" javaType="string"/>
        <result column="locator" property="locator"/>
        <result column="shelfcode" property="shelfCode"/>
        <result column="shelfLay" property="shelfLay"/>
        <result column="wipEntityId" property="wipEntityId"/>
        <result column="stockNo" property="stockNo"/>
        <result column="itemcode" property="itemCode"/>
        <result column="lotcode" property="lotCode"/>
        <result column="quantity" property="quantity"/>
        <result column="isMultiPalForLot" property="isMultiPalForLot"/>
    </resultMap>
    <insert id="insertWmsInvIn" parameterType="com.jhzh.wms.dto.WmsInvInDto">
        insert into yx_ils_whin
         (id,
         unt,
         app,
         taskid,
         tasksource,
          locator,
          shelfcode,
          shelfLay,
          wipEntityId,
          stockNo,
          itemcode,
        lotcode,
          quantity,
          isMultiPalForLot,
          partdate,
           status)
        values (#{id},#{unt},#{app},#{taskId},#{taskSource},#{locator},#{shelfCode},#{shelfLay},#{wipEntityId},#{stockNo},#{itemCode},#{lotCode},#{quantity},#{isMultiPalForLot},CURRENT_TIMESTAMP,#{status})
 </insert>
    <update id="updateStatus" >
        update yx_ils_whin set status=#{status} where taskid=#{key}
    </update>
    <select id="QueryWarehouseFinish" resultMap="wmsInvInDto">
    select
        id, unt,app, taskid, tasksource, locator, shelfcode, shelfLay, wipEntityId, stockNo,itemcode, lotcode,quantity, isMultiPalForLot, status from
        yx_ils_whin  where status=12
</select>
    <select id="queryItemCode" resultMap="wmsInvInDto" parameterType="integer">
        select
        id, unt,app, taskid, tasksource, locator, shelfcode, shelfLay, wipEntityId, stockNo, itemcode,lotcode,quantity, isMultiPalForLot, status
          from yx_ils_whin where status=12
        <if test="itemCode !=null">
         AND   instr(itemCode,#{itemCode})>0
        </if>
    </select>

    <select id="queryWmsInvInForTaskId" resultMap="wmsInvInDto">
        select id, unt,app, taskid, tasksource, locator, shelfcode, shelfLay, wipEntityId, stockNo,itemcode,lotcode,quantity, isMultiPalForLot, status
        from yx_ils_whin
        where taskid=#{taskId}
    </select>
    <select id="queryWmsInvInFlow" resultType="java.util.Map">
        select
        id,
        unt,
        app,
        taskid,
        tasksource,
        locator,
        shelfcode,
        shelflay,
        wipentityid,
        stockno,
        ismultipalforlot,
        lotcode,
        quantity,
        itemcode,
        date_format(partdate,'%Y-%m-%d %H:%i') as partdate,
        (case
           when status = 0 then '任务新建/等待执行'
           when status = 11 then '任务执行中'
           when status = 12 then '任务执行完成'
           when status = 13 then '任务执行异常'
           when status = 14 then '任务取消'
        end) AS status
        from
        yx_ils_whin
        <where>
            <if test="taskid!=null and taskid !=''">
             and taskid=#{taskid}
            </if>
            <if test="partwoid!=null and partwoid !=''">
             and wipentityid=#{partwoid}
            </if>
             <if test="itemcode!=null and itemcode !=''">
             and itemcode=#{itemcode}
            </if>
             <if test="stockno!=null and stockno !=''">
             and stockno=#{stockno}
            </if>
            <if test="locator!=null and locator !='' and locator ==3">
             and locator=#{locator}
            </if>
            <if test="locator!=null and locator !='' and locator !=3">
             and locator !=3
            </if>
            <if test="begindate !=null and begindate !=''">
                and   UNIX_TIMESTAMP(partdate) between #{begindate}/1000 and #{enddate}/1000
            </if>
        </where>
        order by partdate desc
    </select>


</mapper>
